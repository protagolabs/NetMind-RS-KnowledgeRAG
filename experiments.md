# KnowledgeRAG æœ¬åœ°æ•°æ®åº“ & å­˜å‚¨ç¯å¢ƒæŠ€æœ¯è¯´æ˜ï¼ˆNotebookLM RAG èƒ½åŠ›é€†å‘å·¥ç¨‹ï¼‰

**ç‰ˆæœ¬ï¼š** Draft v0.2 
**æ—¥æœŸï¼š** 2025-07-18ï¼ˆæ›´æ–°ï¼‰
**ä½œè€…ï¼š** XYZ-Algorith-Team (Chengyu Huang, Bin Liang, Hongyi Gu, Yujing Wang, Guocheng Hu)
**é€‚ç”¨èŒƒå›´ï¼š** æœ¬æ–‡æ¡£é€‚ç”¨äºåœ¨æœ¬åœ°/å¼€å‘ç¯å¢ƒä¸­æ¨¡æ‹Ÿ NotebookLM é£æ ¼çš„å¤šæ–‡æ¡£ RAGï¼ˆRetrieval-Augmented Generationï¼‰ç³»ç»Ÿï¼Œä»¥å¢å¼ºå¹³å°å†… Agent çš„çŸ¥è¯†è®¿é—®èƒ½åŠ›ã€‚ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²éœ€åŸºäºæœ¬æ–‡æ¡£ä½œé€‚é…ä¸åŠ å›ºã€‚

## ğŸ¯ å½“å‰é¡¹ç›®çŠ¶æ€

**å·²å®ç°æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… ç»Ÿä¸€é…ç½®ç®¡ç†ï¼ˆ.env + config.pyï¼‰
- âœ… åŸºç¡€å­˜å‚¨å±‚ï¼ˆMySQL + Milvus + æœ¬åœ°S3ï¼‰
- âœ… å‘é‡ç»´åº¦ç»Ÿä¸€ç®¡ç†ï¼ˆ1536ç»´ï¼‰
- âœ… å®éªŒç®¡ç†ç³»ç»Ÿ
- âœ… å®Œæ•´çš„RAGæ¼”ç¤ºç³»ç»Ÿ
- âœ… çµæ´»æœç´¢å¼•æ“

**ç³»ç»Ÿå·²å¯ç”¨äºï¼š**
- æ–‡æ¡£ä¸Šä¼ å’Œå‘é‡åŒ–
- è¯­ä¹‰æœç´¢å’Œæ£€ç´¢
- å®éªŒç¯å¢ƒç®¡ç†
- å¿«é€ŸåŸå‹å¼€å‘

> ğŸ“ æœ¬æ–‡æ¡£ä¸å®é™…ä»£ç åŒæ­¥æ›´æ–°ï¼Œåæ˜ å½“å‰é¡¹ç›®çš„çœŸå®çŠ¶æ€ã€‚

---

## 1. æ–‡æ¡£ç›®çš„ä¸ç›®æ ‡

æœ¬è¯´æ˜ç”¨äºï¼š

1. **å®šä¹‰æœ¬åœ°æ¨¡æ‹Ÿç¯å¢ƒ**ï¼šåŸºäº *æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼ˆS3 æ¨¡æ‹Ÿï¼‰+ MySQLï¼ˆç»“æ„åŒ–å…ƒæ•°æ®ï¼‰+ Milvusï¼ˆå‘é‡ç´¢å¼•ï¼‰* çš„ä¸‰å±‚å­˜å‚¨æ¶æ„ã€‚
2. **è§„èŒƒæ•°æ®æ‘„å–ï¼ˆingestionï¼‰æµæ°´çº¿**ï¼šä»ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶å¼€å§‹ï¼Œåˆ°æ¸…æ´—ã€åˆ‡åˆ†ï¼ˆchunkingï¼‰ã€åµŒå…¥ï¼ˆembeddingï¼‰ã€ç»“æ„åŒ–å…¥åº“ã€å¯æ£€ç´¢åŒ–çš„å…¨è¿‡ç¨‹ã€‚
3. **è§„å®šæœ€å°å¿…å¤‡æ–‡ä»¶/æ¨¡å—å†…å®¹è¦æ±‚**ï¼šDB å¯åŠ¨è„šæœ¬ã€æœåŠ¡è®¿é—®å°è£…ã€æ•°æ®æ¨¡å‹ã€æ£€ç´¢æ¥å£ã€å¼•ç”¨è¿½è¸ªã€‚
4. **ä¸ºç ”å‘å›¢é˜Ÿæä¾›è¿­ä»£åŸºçº¿**ï¼šåœ¨æœ¬åœ°ç«¯å¯¹ RAG ç®¡çº¿åšå¿«é€Ÿå®éªŒã€æŒ‡æ ‡è°ƒä¼˜ã€Agent é›†æˆéªŒè¯ã€‚

> **å„ä½å¯ä»¥æŠŠè¿™å¥—æœ¬åœ°ç¯å¢ƒç†è§£ä¸ºï¼šNotebookLM çš„â€œçŸ¥è¯†åŸºåº§ï¼ˆknowledge substrateï¼‰â€åœ¨å•æœºå¯å¤ç°ç‰ˆã€‚**

---

## 2. åœºæ™¯å‡è®¾ä¸çº¦æŸ

### 2.1 ç”¨æˆ·ä¸ç§Ÿæˆ·éš”ç¦»ï¼ˆMulti-Tenancyï¼‰

* å¹³å°æ”¯æŒå¤šç”¨æˆ·ï¼›æ¯ä½ç”¨æˆ·ä¸Šä¼ çš„æ–‡æ¡£éœ€é€»è¾‘éš”ç¦»ã€‚
* åœ¨æœ¬åœ°æ¨¡æ‹Ÿä¸­ï¼Œé€šè¿‡ **user\_id åˆ†åŒºç›®å½• + æ•°æ®åº“è¡Œçº§éš”ç¦»** å®ç°ã€‚
* åç»­å¯æ‰©å±•ä¸ºç»„ç»‡çº§ã€é¡¹ç›®çº§å‘½åç©ºé—´ã€‚

### 2.2 ä¸€æ¬¡æ€§æ‰¹é‡ä¸Šä¼ ã€æ–‡æ¡£å¤æ‚æ€§

* ç”¨æˆ·å¯èƒ½ä¸€æ¬¡ä¸Šä¼ å¤šä¸ªç‰ˆæœ¬ï¼ˆv1, v2â€¦ï¼‰æˆ–å¤šä»½ç›¸äº’å…³è”çš„æ–‡æ¡£ï¼ˆä¸»æ–‡ä»¶ + é™„ä»¶ + æ›´æ–°è¯´æ˜ï¼‰ã€‚
* æ–‡æ¡£é—´å¯èƒ½å­˜åœ¨æ—¶é—´ä¾èµ–ï¼ˆå¦‚â€œ2025-07-16_xx-docâ€ï¼‰ã€ç‰ˆæœ¬ supersedes å…³ç³»ã€äº¤å‰å¼•ç”¨ã€‚
* ç”¨æˆ·ä¹Ÿå¯èƒ½ä¸Šä¼ å…³äºæŸä¸€é¢†åŸŸçš„å„ç§ paper 

### 2.3 Token æˆæœ¬æ§åˆ¶

* å¤„ç†çš„è¦å¿«ï¼Œæ¯”å¦‚ NotebookLM ä¸Šä¼ å®ŒåŸºæœ¬å°±å¯ä»¥ç”¨äº†ï¼Œè¿™ä¸ªä½œä¸ºæˆ‘ä»¬çš„ä¸€ä¸ªç›®æ ‡é€Ÿåº¦ã€‚
* æ£€ç´¢é˜¶æ®µå¿…é¡»åšåˆ°**é«˜ç²¾åº¦ç­›é€‰**ï¼Œä»…å‘ LLM å‘é€æœ€å°å¿…è¦ä¸Šä¸‹æ–‡ã€‚
* æ”¯æŒæ‘˜è¦å‹ç¼©ï¼ˆcontext compressionï¼‰ã€æ—¶é—´è¿‡æ»¤ã€ç‰ˆæœ¬è¿‡æ»¤ã€Cross-Encoder é‡æ’åæˆªæ–­ã€‚

---

## 3. ç³»ç»Ÿæ€»ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            User Upload                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚  (HTTP / CLI / SDK)
               â–¼
        Ingestion Orchestrator
               â”‚
               â”œâ”€â–º Object Store (Local S3æ¨¡æ‹Ÿ)
               â”‚       â€¢ åŸå§‹æ–‡ä»¶ï¼ˆåŸè²Œä¿å­˜ï¼‰
               â”‚       â€¢ æ­£è§„åŒ–è·¯å¾„ï¼š/user/{uid}/doc/{doc_uuid}/v{n}/...
               â”‚
               â”œâ”€â–º Document Parser / Normalizer
               â”‚       â€¢ æ–‡æœ¬æå–ã€ç‰ˆé¢è§£æã€è¡¨æ ¼åˆ†ç¦»ã€å…ƒæ•°æ®æŠ½å–
               â”‚
               â”œâ”€â–º Chunker
               â”‚       â€¢ è¯­ä¹‰/ç»“æ„åˆ†å—ï¼Œå»ºç«‹ chunk_id
               â”‚
               â”œâ”€â–º Embedding Worker
               â”‚       â€¢ ç”Ÿæˆå‘é‡ï¼›å†™ Milvus
               â”‚
               â””â”€â–º Metadata Writer
                       â€¢ æ–‡æ¡£/ç‰ˆæœ¬/å—å…³ç³»å†™ MySQL

Query Flow:
User Query â†’ Query Router â†’ Metadata Filter (user, version, time) â†’ Vector KNN + BM25 â†’ Rerank â†’ Context Compression â†’ LLM â†’ Answer + Citations
```

---

## 4. æ•°æ®ç”Ÿå‘½å‘¨æœŸï¼ˆData Lifecycleï¼‰

| é˜¶æ®µ | è¾“å…¥          | å¤„ç†              | è¾“å‡º          | å†™å…¥å±‚                                 |
| -- | ----------- | --------------- | ----------- | ----------------------------------- |
| ä¸Šä¼  | åŸå§‹æ–‡ä»¶æµ       | æ ¡éªŒã€åˆ†é… doc\_uuid | åŸå§‹æ–‡ä»¶        | S3 æ¨¡æ‹Ÿ                               |
| è§£æ | åŸå§‹æ–‡ä»¶        | æ–‡æœ¬æŠ½å–ã€ç»“æ„åŒ–ã€ç‰ˆæœ¬è¯†åˆ«   | æ­£è§„åŒ–æ–‡æ¡£å—      | MySQL (doc\_versions, parsed\_text) |
| åˆ†å— | ç»“æ„åŒ–æ–‡æœ¬       | è¯­ä¹‰/è§„åˆ™ chunking  | chunk è®°å½•    | MySQL (chunks)                      |
| å‘é‡ | chunk æ–‡æœ¬    | Embedding æ¨¡å‹    | å‘é‡æ•°ç»„        | Milvus (embeddings)                 |
| æ£€ç´¢ | æŸ¥è¯¢          | å‘é‡å¬å› + è¿‡æ»¤       | top-k chunk | å†…å­˜/æœåŠ¡è¿”å›                             |
| ç”Ÿæˆ | top-k chunk | Prompt æ„é€  + LLM | å›ç­” + å¼•ç”¨     | Answer æœåŠ¡ï¼›å¯å†™å®¡è®¡è¡¨                     |

---

## 5. æ•°æ®æ¨¡å‹ï¼ˆæ ¸å¿ƒå®ä½“ï¼‰

> ä»¥ä¸‹ä¸ºæœ€å°åŒ–ï¼ˆMVPï¼‰å­—æ®µï¼›ç”Ÿäº§ç¯å¢ƒå¯å¢åŠ  ACLã€åŠ å¯†ã€å®¡è®¡ã€æ‰©å±•å±æ€§ã€‚

### 5.1 å®ä½“å…³ç³»å›¾ï¼ˆç®€åŒ–ï¼‰

```
User 1â”€â”€â”€* Document 1â”€â”€â”€* DocumentVersion 1â”€â”€â”€* Chunk 1â”€â”€1 Embedding
                                  â”‚
                                  â””â”€â”€* ChunkRelation (*è·¨æ–‡æ¡£/è·¨ç‰ˆæœ¬å¼•ç”¨*)
```

---

### 5.2 è¡¨ï¼š`users`

| å­—æ®µ           | ç±»å‹                        | è¯´æ˜                  |
| ------------ | ------------------------- | ------------------- |
| id (PK)      | BIGINT                    | ç”¨æˆ·å†…éƒ¨ä¸»é”®              |
| external\_id | VARCHAR                   | å¤–éƒ¨è®¤è¯ç³»ç»Ÿ user keyï¼ˆå¯ç©ºï¼‰ |
| name         | VARCHAR                   | æ˜¾ç¤ºåç§°                |
| created\_at  | DATETIME                  | åˆ›å»ºæ—¶é—´                |
| status       | ENUM('active','disabled') | ç”¨æˆ·çŠ¶æ€                |

**æœ€å°‘éœ€å«**ï¼š`id`, `name`, `created_at`ã€‚

---

### 5.3 è¡¨ï¼š`documents`

| å­—æ®µ                     | ç±»å‹       | è¯´æ˜              |
| ---------------------- | -------- | --------------- |
| id (PK)                | BIGINT   |                 |
| user\_id (FK users.id) | BIGINT   | æ‰€å±ç”¨æˆ·            |
| doc\_uuid              | CHAR(36) | è·¨ç‰ˆæœ¬ä¸å˜çš„æ–‡æ¡£å…¨å±€æ ‡è¯†    |
| title                  | VARCHAR  | æ–‡æ¡£åï¼ˆå¯æ¥è‡ªæ–‡ä»¶åæˆ–å…ƒæ•°æ®ï¼‰ |
| mime\_type             | VARCHAR  | åŸå§‹æ–‡ä»¶ç±»å‹          |
| created\_at            | DATETIME |                 |
| latest\_version\_id    | BIGINT   | å¿«é€ŸæŒ‡å‘å½“å‰æœ€æ–°ç‰ˆæœ¬      |

**æœ€å°‘éœ€å«**ï¼š`id`, `user_id`, `doc_uuid`, `title`ã€‚

---

### 5.4 è¡¨ï¼š`document_versions`

| å­—æ®µ                             | ç±»å‹                           | è¯´æ˜                       |
| ------------------------------ | ---------------------------- | ------------------------ |
| id (PK)                        | BIGINT                       |                          |
| document\_id (FK documents.id) | BIGINT                       |                          |
| version\_label                 | VARCHAR                      | äººç±»å¯è¯»ç‰ˆæœ¬å·ï¼Œå¦‚ `v1`, `2024Q4` |
| source\_uri                    | TEXT                         | S3 è·¯å¾„ï¼ˆåŸå§‹æ–‡ä»¶ï¼‰              |
| checksum                       | CHAR(64)                     | SHA256ï¼›ç”¨äºå»é‡              |
| effective\_date                | DATE                         | å†…å®¹â€œæˆªè‡³æ—¥æœŸâ€ï¼ˆä¸šåŠ¡è¯­ä¹‰ï¼‰           |
| uploaded\_at                   | DATETIME                     | ä¸Šä¼ æ—¶é—´                     |
| parsed\_status                 | ENUM('pending','ok','error') | è§£æçŠ¶æ€                     |

**æœ€å°‘éœ€å«**ï¼š`id`, `document_id`, `source_uri`, `uploaded_at`ã€‚

---

### 5.5 è¡¨ï¼š`chunks`

| å­—æ®µ                                     | ç±»å‹         | è¯´æ˜                            |
| -------------------------------------- | ---------- | ----------------------------- |
| id (PK)                                | BIGINT     |                               |
| version\_id (FK document\_versions.id) | BIGINT     |                               |
| chunk\_uid                             | CHAR(36)   | å…¨å±€ chunk æ ‡è¯†ï¼ˆå¯ç”¨äºå¼•ç”¨ï¼‰            |
| seq\_no                                | INT        | åœ¨æ–‡æ¡£å†…é¡ºåº                        |
| section\_path                          | VARCHAR    | å±‚çº§è·¯å¾„ï¼š`1.Intro/1.2.Background` |
| page\_no                               | INT        | åŸå§‹é¡µç ï¼ˆå¯ç©ºï¼‰                      |
| text                                   | MEDIUMTEXT | æ¸…æ´—åçš„æ–‡æœ¬                        |
| token\_count                           | INT        | tokensï¼ˆä¼°ç®—ï¼‰                    |

**æœ€å°‘éœ€å«**ï¼š`id`, `version_id`, `seq_no`, `text`ã€‚

---

### 5.6 è¡¨ï¼š`embeddings`

| å­—æ®µ                       | ç±»å‹       | è¯´æ˜                                        |
| ------------------------ | -------- | ----------------------------------------- |
| id (PK)                  | BIGINT   |                                           |
| chunk\_id (FK chunks.id) | BIGINT   |                                           |
| model\_name              | VARCHAR  | ä½¿ç”¨çš„ embedding æ¨¡å‹                          |
| dim                      | INT      | å‘é‡ç»´åº¦                                      |
| vector\_ref              | VARCHAR  | Milvus collection + pkï¼ˆæˆ–ç›´æ¥å­˜ FAISS ç´¢å¼• keyï¼‰ |
| created\_at              | DATETIME |                                           |

**æœ€å°‘éœ€å«**ï¼š`id`, `chunk_id`, `model_name`, `vector_ref`ã€‚

> **æ³¨æ„**ï¼šå‘é‡æœ¬ä½“ä¸å­˜ SQLï¼›ä»…å­˜å¼•ç”¨ã€‚Milvus ä¸­éœ€é•œåƒå­—æ®µï¼š`embedding_id`, `chunk_uid`, `user_id`, `doc_uuid`, `version_label`, `timestamp`ï¼Œä¾¿äºè¿‡æ»¤ã€‚

---

### 5.7 è¡¨ï¼š`chunk_relations`ï¼ˆå¯é€‰ / V1.5ï¼‰

| å­—æ®µ             | ç±»å‹                                                      | è¯´æ˜    |
| -------------- | ------------------------------------------------------- | ----- |
| id (PK)        | BIGINT                                                  |       |
| src\_chunk\_id | BIGINT                                                  |       |
| dst\_chunk\_id | BIGINT                                                  |       |
| relation\_type | ENUM('refers\_to','updates','duplicates','contradicts') |       |
| weight         | FLOAT                                                   | å…³ç³»ç½®ä¿¡åº¦ |

ç”¨äºæ„å»º Graph-RAGï¼›æ—©æœŸå¯ç©ºè¡¨ã€‚

---

### 5.8 è¡¨ï¼š`ingestion_jobs`ï¼ˆæµæ°´ç›‘æ§ï¼‰

| å­—æ®µ                    | ç±»å‹                                                        | è¯´æ˜ |
| --------------------- | --------------------------------------------------------- | -- |
| id                    | BIGINT                                                    |    |
| user\_id              | BIGINT                                                    |    |
| document\_version\_id | BIGINT                                                    |    |
| phase                 | ENUM('upload','parse','chunk','embed','complete','error') |    |
| log                   | JSON                                                      |    |
| updated\_at           | DATETIME                                                  |    |

---

## 6. å­˜å‚¨å±‚å®ç°ç»†èŠ‚

### 6.1 æœ¬åœ° S3 æ¨¡æ‹Ÿ

**è·¯å¾„çº¦å®šï¼š**

```
./data/object_store/
  â””â”€â”€ user_{user_id}/
        â””â”€â”€ {doc_uuid}/
              â””â”€â”€ v{n}/
                    original.{ext}
                    derived/
                       text.json
                       tables.parquet
```

**æœ€å°‘è¦æ±‚ï¼š**

* åŸå§‹æ–‡ä»¶ä¿ç•™åŸæ‰©å±•åï¼›ä¸å¯è¦†ç›–ï¼ˆè¿½åŠ ç‰ˆæœ¬ï¼‰ã€‚
* ä¸Šä¼ å³è®¡ç®—å¹¶è½åœ° `sha256`ï¼›å†™å…¥ `document_versions.checksum`ã€‚
* è§£æäº§ç‰©ï¼ˆç»“æ„åŒ– JSONã€é¡µé¢åˆ‡ç‰‡ã€å›¾åƒåˆ‡ç‰‡ï¼‰å¯æ”¾ `derived/` å­ç›®å½•ã€‚

**å¿…å¤‡æ¥å£ï¼ˆs3\_local.pyï¼‰**

* `put_object(user_id, doc_uuid, version_label, file_stream) -> source_uri`
* `get_object(source_uri) -> bytes`
* `list_user_docs(user_id) -> [source_uri...]`
* `generate_local_url(source_uri) -> str` ï¼ˆè°ƒè¯•ç”¨ï¼‰

---

### 6.2 MySQL å…ƒæ•°æ®å±‚

**è¿æ¥é…ç½®**ï¼š`.env` æˆ– `config.yaml`ï¼›é¡»æ”¯æŒè¿æ¥æ± ã€‚

**æœ€å°‘æ¥å£ï¼ˆmysql\_client.pyï¼‰**

* `create_document(user_id, title, mime_type) -> doc_id`
* `create_version(doc_id, source_uri, version_label, effective_date=None) -> version_id`
* `bulk_insert_chunks(version_id, chunk_records: List[ChunkIn])`
* `link_embedding(chunk_id, vector_ref, model_name)`
* `get_chunks(version_id, filters=...)`
* `resolve_latest_version(doc_uuid)`
* `fetch_metadata_for_chunks(chunk_ids) -> [{chunk,text,section,page,...}]`

**è¿ç§»ç®¡ç†**ï¼šä½¿ç”¨ Alembic æˆ–è‡ªå†™ SQL è„šæœ¬ï¼›æ¨¡æ‹Ÿç¯å¢ƒå¯åœ¨ `./db_server/sql/schema.sql` æä¾›ä¸€æ¬¡å»ºåº“è„šæœ¬ã€‚

---

### 6.3 Milvus å‘é‡åº“ï¼ˆå½“å‰é…ç½®ï¼‰

**Collection å‘½å**ï¼š`rag_embeddings_v1`

**å­—æ®µç»“æ„ï¼ˆMilvus Schemaï¼‰**

| å­—æ®µ             | ç±»å‹                    | æ³¨é‡Š                        |
| -------------- | --------------------- | ------------------------- |
| embedding\_id  | Int64                 | PKï¼Œå¯¹åº” SQL `embeddings.id` |
| user\_id       | Int64                 | ç”¨äºç§Ÿæˆ·è¿‡æ»¤                    |
| doc\_uuid      | VarChar(36)           | æ–‡æ¡£æ ‡è¯†                      |
| version\_label | VarChar(50)           | ç‰ˆæœ¬è¿‡æ»¤                      |
| chunk\_uid     | VarChar(36)           | åæŸ¥ chunk                  |
| vector         | FloatVector(dim=1536) | 1536ç»´å‘é‡                   |
| ts             | Int64                 | ä¸Šä¼ æ—¶é—´æˆ³                     |

**ç´¢å¼•é…ç½®**

* **ç´¢å¼•ç±»å‹**ï¼šHNSWï¼ˆé«˜æ€§èƒ½è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ï¼‰
* **è·ç¦»åº¦é‡**ï¼šCOSINEï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰
* **ç´¢å¼•å‚æ•°**ï¼šM=16, efConstruction=200
* **æœç´¢å‚æ•°**ï¼šef=200

**å¿…å¤‡æ¥å£ï¼ˆmilvus\_client.pyï¼‰**

* `upsert_embedding(embedding_id, user_id, doc_uuid, version_label, chunk_uid, vector)`
* `search(vector, top_k, user_id=None, doc_uuid=None, version_label=None, ts_range=None) -> [hits]`
* `delete_embeddings(chunk_uid_list)`
* `create_collection_if_not_exists()`

---

## 7. ä»£ç ç›®å½•ç»“æ„ï¼ˆå½“å‰å®é™…ç»“æ„ï¼‰

```
repo_root/
â”œâ”€ db_server/                    # æ•°æ®åº“æœåŠ¡å’Œå®éªŒç®¡ç†
â”‚   â”œâ”€ docker-compose.yml        # ä¸€é”®å¯åŠ¨å…¨éƒ¨ä¾èµ–
â”‚   â”œâ”€ experiment_manager.py     # å®éªŒç®¡ç†å·¥å…·
â”‚   â”œâ”€ experiment_data.py        # å®éªŒæ•°æ®ç®¡ç†
â”‚   â”œâ”€ experiment_schemas.py     # å®éªŒæ¨¡å¼ç®¡ç†
â”‚   â”œâ”€ quick_start_example.py    # å¿«é€Ÿå¼€å§‹ç¤ºä¾‹
â”‚   â”œâ”€ RAG_EXPERIMENT_GUIDE.md   # å®éªŒæŒ‡å—
â”‚   â”œâ”€ schema_templates/         # æ¨¡å¼æ¨¡æ¿
â”‚   â”‚   â”œâ”€ basic_rag.yaml
â”‚   â”‚   â”œâ”€ vector_experiment.yaml
â”‚   â”‚   â””â”€ ...
â”‚   â””â”€ sql/                      # æ•°æ®åº“ç»“æ„å®šä¹‰
â”‚       â””â”€ schema.sql
â”‚
â”œâ”€ src/                          # æ ¸å¿ƒæºä»£ç 
â”‚   â””â”€ knowledge_rag/
â”‚       â”œâ”€ __init__.py
â”‚       â”œâ”€ config.py             # é…ç½®ç®¡ç†ï¼ˆæ”¯æŒ.envæ–‡ä»¶ï¼‰
â”‚       â”œâ”€ file_process/         # æ–‡ä»¶å¤„ç†æ¨¡å—
â”‚       â”‚   â””â”€ __init__.py       # (å¾…å®ç°å…·ä½“è§£æå™¨)
â”‚       â”œâ”€ knowledge_process/    # çŸ¥è¯†å¤„ç†æ¨¡å—
â”‚       â”‚   â””â”€ __init__.py       # (å¾…å®ç°åˆ†å—ã€åµŒå…¥ç­‰)
â”‚       â”œâ”€ knowledge_retrieval/  # çŸ¥è¯†æ£€ç´¢æ¨¡å—
â”‚       â”‚   â””â”€ __init__.py       # (å¾…å®ç°æ£€ç´¢ã€é‡æ’ç­‰)
â”‚       â”œâ”€ rag_chat/            # RAG èŠå¤©æ¨¡å—
â”‚       â”‚   â””â”€ __init__.py       # (å¾…å®ç°èŠå¤©ä»£ç†)
â”‚       â””â”€ utils/               # å·¥å…·æ¨¡å—ï¼ˆå·²å®ç°ï¼‰
â”‚           â”œâ”€ __init__.py
â”‚           â”œâ”€ s3_local.py       # æœ¬åœ°S3æ¨¡æ‹Ÿ
â”‚           â”œâ”€ mysql_client.py   # MySQLå®¢æˆ·ç«¯
â”‚           â”œâ”€ milvus_client.py  # Milvuså®¢æˆ·ç«¯
â”‚           â”œâ”€ flexible_search.py # çµæ´»æœç´¢å¼•æ“
â”‚           â””â”€ logging_utils.py  # æ—¥å¿—å·¥å…·
â”‚
â”œâ”€ .env                         # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€ experiments.md               # æœ¬æŠ€æœ¯æ–‡æ¡£
â”œâ”€ logs/                        # æ—¥å¿—ç›®å½•
â””â”€ data/                        # æ•°æ®ç›®å½•
    â”œâ”€ local_object_store/      # æœ¬åœ°å¯¹è±¡å­˜å‚¨
    â”œâ”€ mysql/                   # MySQLæ•°æ®
    â””â”€ milvus/                  # Milvusæ•°æ®
```

---

## 8. å„ Python æ¨¡å—å½“å‰å®ç°çŠ¶æ€

> ä¸‹åˆ—ä¸º **å½“å‰å·²å®ç°** å’Œ **å¾…å®ç°** çš„æ¨¡å—çŠ¶æ€ã€‚

### 8.1 `config.py` âœ… **å·²å®ç°**

* è‡ªåŠ¨åŠ è½½ `.env` æ–‡ä»¶å’Œç¯å¢ƒå˜é‡
* æä¾›å®Œæ•´çš„é…ç½®ç®¡ç†ï¼šæ•°æ®åº“ã€Milvusã€åµŒå…¥æ¨¡å‹ã€Tokené¢„ç®—ç­‰
* æ”¯æŒ `get_settings()` å•ä¾‹æ¨¡å¼
* é»˜è®¤1536ç»´å‘é‡é…ç½®

### 8.2 `utils/s3_local.py` âœ… **å·²å®ç°**

* æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ¨¡æ‹ŸS3å­˜å‚¨
* æ”¯æŒç”¨æˆ·éš”ç¦»çš„ç›®å½•ç»“æ„
* æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½/åˆ—è¡¨åŠŸèƒ½
* è‡ªåŠ¨è®¡ç®—checksumå’Œå…ƒæ•°æ®ç®¡ç†

### 8.3 `utils/mysql_client.py` âœ… **å·²å®ç°**

* åŸºäº mysql-connector-python çš„è¿æ¥æ± 
* æ–‡æ¡£/ç‰ˆæœ¬/å—çš„å®Œæ•´CRUDæ“ä½œ
* æ”¯æŒæ‰¹é‡æ’å…¥å’Œäº‹åŠ¡ç®¡ç†
* å®ç°äº† `get_mysql_client()` å•ä¾‹

### 8.4 `utils/milvus_client.py` âœ… **å·²å®ç°**

* å®Œæ•´çš„Milvusé›†åˆç®¡ç†ï¼ˆåˆ›å»ºã€ç´¢å¼•ã€åŠ è½½ï¼‰
* æ”¯æŒ1536ç»´å‘é‡çš„HNSWç´¢å¼•
* å‘é‡æœç´¢æ”¯æŒmetadataè¿‡æ»¤
* æ‰¹é‡å‘é‡æ’å…¥å’Œåˆ é™¤åŠŸèƒ½

### 8.5 `utils/flexible_search.py` âœ… **å·²å®ç°**

* çµæ´»çš„æœç´¢å¼•æ“ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢ã€å…³é”®è¯æœç´¢ã€æ··åˆæœç´¢
* è‡ªåŠ¨ä»é…ç½®è·å–å‘é‡ç»´åº¦
* æ”¯æŒå¤šè¡¨æœç´¢å’Œå®éªŒç¯å¢ƒåˆ‡æ¢

### 8.6 `utils/logging_utils.py` âœ… **å·²å®ç°**

* ç»“æ„åŒ–æ—¥å¿—è®°å½•ç³»ç»Ÿ
* æ”¯æŒæŸ¥è¯¢æ—¥å¿—ã€æ€§èƒ½æ—¥å¿—ã€é”™è¯¯æ—¥å¿—
* å¤šç§æ—¥å¿—çº§åˆ«å’Œè¾“å‡ºæ ¼å¼

### 8.7 `file_process/` â³ **å¾…å®ç°**

* æ–‡æ¡£è§£æå™¨ï¼ˆPDFã€Docxã€HTMLã€Markdownç­‰ï¼‰
* ç»“æ„åŒ–æ–‡æœ¬æå–å’Œå…ƒæ•°æ®æŠ½å–
* è§£æé”™è¯¯å¤„ç†å’ŒçŠ¶æ€è·Ÿè¸ª

### 8.8 `knowledge_process/` â³ **å¾…å®ç°**

* æ–‡æœ¬åˆ†å—ç­–ç•¥ï¼ˆè¯­ä¹‰åˆ†å—ã€ç»“æ„åˆ†å—ï¼‰
* åµŒå…¥æ¨¡å‹å°è£…ï¼ˆOpenAIã€BGEã€Instructorç­‰ï¼‰
* å…ƒæ•°æ®ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶

### 8.9 `knowledge_retrieval/` â³ **å¾…å®ç°**

* æ£€ç´¢ç®¡çº¿ï¼ˆè¿‡æ»¤ã€KNNã€é‡æ’ï¼‰
* ä¸Šä¸‹æ–‡å‹ç¼©å’ŒTokené¢„ç®—ç®¡ç†
* å¼•ç”¨è¿½è¸ªå’Œç§Ÿæˆ·å®‰å…¨è¿‡æ»¤

### 8.10 `rag_chat/` â³ **å¾…å®ç°**

* RAGèŠå¤©ä»£ç†
* å¯¹è¯å†å²ç®¡ç†
* æ™ºèƒ½æ£€ç´¢ç­–ç•¥

---

## 9. DB å¯åŠ¨è„šæœ¬å’Œå®éªŒç®¡ç†ï¼ˆ./db\_server/ï¼‰

### 9.1 `docker-compose.yml` âœ… **å·²å®ç°**

* **ä¸€é”®å¯åŠ¨å…¨éƒ¨æœåŠ¡**ï¼š`docker compose up -d`
* **æœåŠ¡åŒ…å«**ï¼š
  * MySQL 8.0.42ï¼šç«¯å£ 3306ï¼Œæ•°æ®åº“ `knowledge_rag`
  * Milvus v2.4.15ï¼šç«¯å£ 19530/9091ï¼Œæ”¯æŒå‘é‡æœç´¢
  * Python 3.12ï¼šåº”ç”¨è¿è¡Œç¯å¢ƒ
* **æ•°æ®æŒä¹…åŒ–**ï¼šæ‰€æœ‰æ•°æ®ä¿å­˜åœ¨ `./db_server/data/` ç›®å½•
* **ç½‘ç»œé…ç½®**ï¼šæœåŠ¡é—´é€šè¿‡å†…éƒ¨ç½‘ç»œ `knowledge_rag_network` é€šä¿¡

### 9.2 `experiment_manager.py` âœ… **å·²å®ç°**

* åˆ›å»ºã€åˆ‡æ¢ã€åˆ é™¤å®éªŒ
* æ¯ä¸ªå®éªŒæœ‰ç‹¬ç«‹çš„æ•°æ®åº“å‰ç¼€
* æ”¯æŒäº¤äº’å¼å®éªŒç®¡ç†
* å®éªŒé…ç½®æ–‡ä»¶ç®¡ç†

### 9.3 `experiment_data.py` âœ… **å·²å®ç°**

* ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨
* æ”¯æŒMySQLå’ŒMilvusçš„æ•°æ®æ“ä½œ
* å®éªŒæ•°æ®çš„åˆ›å»ºã€åˆ é™¤ã€é‡ç½®
* å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€ç›‘æ§

### 9.4 `experiment_schemas.py` âœ… **å·²å®ç°**

* å®éªŒæ¨¡å¼ç®¡ç†å™¨
* æ”¯æŒå¤šç§é¢„å®šä¹‰æ¨¡å¼ï¼ˆbasic_ragã€vector_experimentç­‰ï¼‰
* åŠ¨æ€è¡¨ç»“æ„åˆ›å»ºå’Œç®¡ç†
* æ¨¡å¼æ¨¡æ¿ç³»ç»Ÿ

### 9.5 `quick_start_example.py` âœ… **å·²å®ç°**

* å®Œæ•´çš„RAGç³»ç»Ÿæ¼”ç¤º
* æ–‡æ¡£ä¸Šä¼ ã€å¤„ç†ã€å‘é‡åŒ–æµç¨‹
* æœç´¢åŠŸèƒ½æµ‹è¯•
* ç«¯åˆ°ç«¯çš„ç³»ç»ŸéªŒè¯

### 9.6 å¸¸ç”¨ Docker Compose å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
cd db_server && docker compose up -d

# åœæ­¢æœåŠ¡
docker compose down

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# é‡å¯æœåŠ¡
docker compose restart
```

---

## 10. é…ç½®æ–‡ä»¶è¦æ±‚

### `.env` æ–‡ä»¶ âœ… **å·²å®ç°**

```bash
# KnowledgeRAG ç¯å¢ƒå˜é‡é…ç½®
# ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨å®‰å…¨çš„é…ç½®ç®¡ç†å·¥å…·

# æ•°æ®åº“é…ç½®
MYSQL_HOST=127.0.0.1
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=devpass
MYSQL_DB=knowledge_rag
MYSQL_CHARSET=utf8mb4
MYSQL_COLLATION=utf8mb4_unicode_ci
MYSQL_POOL_SIZE=10

# Milvus å‘é‡æ•°æ®åº“é…ç½®
MILVUS_HOST=127.0.0.1
MILVUS_PORT=19530
MILVUS_COLLECTION=rag_embeddings_v1
MILVUS_ALIAS=default

# åµŒå…¥æ¨¡å‹é…ç½®
EMBEDDING_MODEL=bge-small-zh-v1.5
EMBEDDING_DIMENSION=1536
EMBEDDING_BATCH_SIZE=32
EMBEDDING_MAX_SEQ_LENGTH=512
EMBEDDING_DEVICE=auto

# å¯¹è±¡å­˜å‚¨é…ç½®
OBJECT_STORE_TYPE=local
OBJECT_STORE_BASE_PATH=./data/local_object_store
OBJECT_STORE_AUTO_CREATE_DIRS=true
OBJECT_STORE_EXPERIMENTS_DIR=experiments
OBJECT_STORE_MAX_FILE_SIZE=104857600  # 100MB

# Token é¢„ç®—é…ç½®
MAX_CONTEXT_TOKENS=2048
CHUNK_MAX_TOKENS=350
TOP_K_RAW=20
TOP_M_RERANK=5
COMPRESSION_RATIO=0.5

# æ£€ç´¢é…ç½®
VECTOR_SIMILARITY_THRESHOLD=0.7
ENABLE_RERANK=true
RERANK_MODEL=bge-reranker-base
ENABLE_COMPRESSION=true

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_DIR=./logs
LOG_MAX_SIZE=10485760  # 10MB
LOG_BACKUP_COUNT=5
LOG_ENABLE_CONSOLE=true
LOG_ENABLE_FILE=true

# å®‰å…¨é…ç½®
SECRET_KEY=your-secret-key-here-change-in-production
ALLOWED_HOSTS=localhost,127.0.0.1
ENABLE_RATE_LIMITING=true
MAX_REQUESTS_PER_MINUTE=60

# ç¯å¢ƒé…ç½®
ENVIRONMENT=development
DEBUG=true
```

### é…ç½®ç®¡ç†ç‰¹æ€§

* **è‡ªåŠ¨åŠ è½½**ï¼š`config.py` ä¼šè‡ªåŠ¨åŠ è½½ `.env` æ–‡ä»¶
* **ä¼˜å…ˆçº§**ï¼šç¯å¢ƒå˜é‡ > .env æ–‡ä»¶ > é»˜è®¤å€¼
* **ç±»å‹å®‰å…¨**ï¼šæ‰€æœ‰é…ç½®é¡¹éƒ½æœ‰ç±»å‹æ£€æŸ¥å’ŒéªŒè¯
* **æ¨¡å—åŒ–**ï¼šæŒ‰åŠŸèƒ½åˆ†ç»„çš„é…ç½®ç±»
* **å‘é‡ç»´åº¦ç»Ÿä¸€**ï¼šé»˜è®¤1536ç»´ï¼Œæ‰€æœ‰æ¨¡å—ä»é…ç½®è·å–

> ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ secret managerï¼ˆAWS Secrets Manager / GCP Secret Managerï¼‰ã€‚

---

## 11. æ£€ç´¢ä¸ç”Ÿæˆæµç¨‹ï¼ˆPseudo-codeï¼‰

```python
from knowledge_rag.utils import retrieval, citation

results = retrieval.search(
    user_id=user_id,
    query=user_query,
    doc_filters={"doc_uuid": selected_docs},
    version_policy="latest",  # or "as_of_date"
    time_range=(None, cutoff_date),
    top_k=20,
    top_m=5,
)

context_blocks = results.context  # [{chunk_uid, text, ...}]
answer, raw = llm_answer(query=user_query, context=context_blocks)

answer_with_refs = citation.attach(answer, context_blocks)
return answer_with_refs
```

---

## 12. Token æˆæœ¬æ§åˆ¶ç­–ç•¥ï¼ˆå½“å‰é…ç½®ï¼‰

| æ§åˆ¶ç‚¹               | å®ç°                   | å½“å‰é…ç½®å€¼    | ç¯å¢ƒå˜é‡                    |
| ----------------- | -------------------- | -------- | ----------------------- |
| å‘é‡å¬å›ä¸Šé™            | top\_k\_raw          | 20       | TOP\_K\_RAW             |
| Rerank è£å‰ª         | top\_m               | 5        | TOP\_M\_RERANK          |
| å•å—æœ€å¤§ token        | chunk\_max\_tokens   | 350      | CHUNK\_MAX\_TOKENS      |
| Context å‹ç¼©        | å‹ç¼©æ¯”                  | 0.5      | COMPRESSION\_RATIO      |
| LLM Prompt Budget | max\_context\_tokens | 2048     | MAX\_CONTEXT\_TOKENS    |
| å‘é‡ç›¸ä¼¼åº¦é˜ˆå€¼           | similarity\_threshold | 0.7      | VECTOR\_SIMILARITY\_THRESHOLD |

### æˆæœ¬æ§åˆ¶ç­–ç•¥

**å½“å€™é€‰å—æ€» token è¶…é¢„ç®—æ—¶ï¼š**

1. **ä¼˜å…ˆçº§æ’åº**ï¼šé«˜å¾—åˆ† + æœ€æ–°ç‰ˆæœ¬å—ä¼˜å…ˆä¿ç•™
2. **æ™ºèƒ½åˆå¹¶**ï¼šåŒç« èŠ‚å—è¿›è¡Œæ‘˜è¦åˆå¹¶
3. **æ¸è¿›æˆªæ–­**ï¼šè¶…é™åˆ™æˆªæ–­å¹¶è®°å½•è­¦å‘Šæ—¥å¿—
4. **åŠ¨æ€è°ƒæ•´**ï¼šæ ¹æ®æŸ¥è¯¢å¤æ‚åº¦è°ƒæ•´top_kå‚æ•°

**é…ç½®çµæ´»æ€§ï¼š**
- æ‰€æœ‰å‚æ•°å¯é€šè¿‡ `.env` æ–‡ä»¶è°ƒæ•´
- æ”¯æŒå®éªŒç¯å¢ƒç‹¬ç«‹é…ç½®
- å®æ—¶é…ç½®é‡è½½ï¼ˆé‡å¯æœåŠ¡ç”Ÿæ•ˆï¼‰

---

## 13. æµ‹è¯•ç­–ç•¥

### 13.1 æ ·æœ¬é›†

* é€‰æ‹© 5\~10 ä»½çœŸå®æ ¼å¼ï¼ˆPDF, MD, HTML, PPTX mixï¼‰
* æ‰‹å·¥æ ‡æ³¨ï¼š

  * ç‰ˆæœ¬ä¾èµ–é—®é¢˜ï¼ˆv1 vs v2ï¼‰
  * æ—¶é—´æˆªæ–­é—®é¢˜ï¼ˆâ€œæˆªè‡³ 2023â€ï¼‰
  * è·¨æ–‡æ¡£å¼•ç”¨é—®é¢˜ï¼ˆä¸»æ–‡æ¡£+é™„å½•ï¼‰

### 13.2 è‡ªåŠ¨åŒ–æµ‹è¯•

* `test_ingestion.py`ï¼šä¸Šä¼ ååº”ç”Ÿæˆ doc/version/chunk/embedding è®°å½•ï¼›checksum å”¯ä¸€ã€‚
* `test_retrieval.py`ï¼šç‰¹å®šæŸ¥è¯¢å¿…é¡»å‘½ä¸­æŒ‡å®š chunk\_idã€‚
* `test_citation.py`ï¼šå›ç­”ä¸­å‡ºç°å¼•ç”¨ç¼–å·ï¼›ç¼–å·å¯è§£æå› source\_uriã€‚
* `test_token_budget.py`ï¼šè¶…å¤§æ–‡æ¡£æ—¶è¾“å‡ºä¸Šä¸‹æ–‡ < é¢„ç®—ã€‚

---

## 14. å¼€å‘å·¥ä½œæµå»ºè®®

### å¿«é€Ÿå¼€å§‹æµç¨‹ âœ…

1. **å¯åŠ¨ä¾èµ–æœåŠ¡**ï¼š
   ```bash
   cd db_server && docker compose up -d
   ```

2. **å®‰è£…Pythonä¾èµ–**ï¼š
   ```bash
   pip install mysql-connector-python pymilvus python-dotenv
   ```

3. **è¿è¡Œå¿«é€Ÿå¼€å§‹ç¤ºä¾‹**ï¼š
   ```bash
   cd db_server && python quick_start_example.py
   ```

4. **æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€**ï¼š
   ```bash
   # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
   docker compose ps
   
   # æŸ¥çœ‹æ—¥å¿—
   docker compose logs -f
   
   # æ£€æŸ¥æ•°æ®åº“
   python experiment_data.py --action health-check
   ```

### å®éªŒç®¡ç†å·¥ä½œæµ âœ…

1. **åˆ›å»ºæ–°å®éªŒ**ï¼š
   ```bash
   python experiment_manager.py --action create --name my_experiment
   ```

2. **åˆ‡æ¢å®éªŒç¯å¢ƒ**ï¼š
   ```bash
   python experiment_manager.py --action switch --name my_experiment
   ```

3. **ç®¡ç†å®éªŒæ•°æ®**ï¼š
   ```bash
   # åˆ›å»ºå®éªŒæ•°æ®
   python experiment_data.py --action create --experiment my_experiment
   
   # é‡ç½®å®éªŒæ•°æ®
   python experiment_data.py --action reset --experiment my_experiment
   ```

### å¼€å‘å’Œè°ƒè¯•

1. **é…ç½®ç®¡ç†**ï¼šæ‰€æœ‰é…ç½®é€šè¿‡ `.env` æ–‡ä»¶ç®¡ç†ï¼Œæ”¯æŒçƒ­é‡è½½
2. **æ—¥å¿—ç³»ç»Ÿ**ï¼šç»“æ„åŒ–æ—¥å¿—ä¿å­˜åœ¨ `./logs/` ç›®å½•
3. **æœç´¢è°ƒè¯•**ï¼šä½¿ç”¨ `flexible_search.py` çš„å‘½ä»¤è¡Œå·¥å…·
4. **å‘é‡éªŒè¯**ï¼šæ£€æŸ¥Milvusé›†åˆçŠ¶æ€å’Œç»´åº¦é…ç½®

---

## 15. ç”Ÿäº§åŒ–è¿ç§»æ³¨æ„äº‹é¡¹ï¼ˆå±•æœ›ï¼‰

| æœ¬åœ°æ¨¡æ‹Ÿ           | ç”Ÿäº§æ›¿ä»£                          | å…³é”®å·®å¼‚          |
| -------------- | ----------------------------- | ------------- |
| æœ¬åœ° dir (S3 æ¨¡æ‹Ÿ) | AWS S3 / GCS / OSS            | IAMã€åŠ å¯†ã€ç”Ÿå‘½å‘¨æœŸç­–ç•¥ |
| MySQL          | Aurora MySQL / Cloud SQL      | é«˜å¯ç”¨ã€è¯»å†™åˆ†ç¦»ã€å¤‡ä»½   |
| Milvus æœ¬åœ°      | Zilliz Cloud / Managed Milvus | æ‰˜ç®¡ç¼©æ”¾ã€ç›‘æ§ã€åˆ†åŒºç­–ç•¥  |
| Plain Text     | åŠ å¯†é™æ€å­˜å‚¨                        | KMS é›†æˆ        |
| æ‰‹å·¥ç§Ÿæˆ·éš”ç¦»         | IAM + row-level policy        | åˆè§„æ€§ã€å®¡è®¡        |

---

## 16. åè¯ç´¢å¼•ï¼ˆGlossaryï¼‰

* **Chunk**ï¼šç»è¿‡è¯­ä¹‰æˆ–ç»“æ„åˆ‡åˆ†çš„æœ€å°æ£€ç´¢å•å…ƒï¼Œé€šå¸¸ 150â€“400 tokensã€‚
* **Embedding**ï¼šChunk æ–‡æœ¬ç»ç¼–ç æ¨¡å‹æ˜ å°„åˆ°å‘é‡ç©ºé—´çš„æµ®ç‚¹æ•°ç»„ï¼Œå½“å‰ç³»ç»Ÿä½¿ç”¨1536ç»´ã€‚
* **Version Policy**ï¼šæ£€ç´¢æ—¶å…³äºæ–‡æ¡£ç‰ˆæœ¬é€‰æ‹©çš„ç­–ç•¥ï¼Œå¦‚ *latest*, *as\_of\_date*, *all\_versions*ã€‚
* **Context Compression**ï¼šåœ¨ä¸æ˜¾è‘—æŸå¤±è¯­ä¹‰è¦†ç›–çš„æƒ…å†µä¸‹å‹ç¼©é€å…¥ LLM çš„ä¸Šä¸‹æ–‡æ–‡æœ¬é‡çš„æŠ€æœ¯æ–¹æ³•ã€‚
* **å®éªŒç¯å¢ƒ**ï¼šç‹¬ç«‹çš„æ•°æ®åº“å‘½åç©ºé—´ï¼Œç”¨äºéš”ç¦»ä¸åŒçš„å®éªŒæ•°æ®å’Œé…ç½®ã€‚
* **FlexibleSearch**ï¼šæ”¯æŒå¤šç§æœç´¢ç­–ç•¥ï¼ˆè¯­ä¹‰ã€å…³é”®è¯ã€æ··åˆï¼‰çš„ç»Ÿä¸€æœç´¢å¼•æ“ã€‚
* **Vector Dimension**ï¼šå‘é‡ç»´åº¦ï¼Œç³»ç»Ÿç»Ÿä¸€é…ç½®ä¸º1536ç»´ï¼Œå¯é€šè¿‡ç¯å¢ƒå˜é‡è°ƒæ•´ã€‚
* **HNSW**ï¼šåˆ†å±‚å¯å¯¼èˆªå°ä¸–ç•Œå›¾ç®—æ³•ï¼Œç”¨äºé«˜æ•ˆçš„è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ã€‚
* **Milvus Collection**ï¼šMilvusä¸­çš„æ•°æ®é›†åˆï¼Œç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ã€‚

---

## 17. åç»­å·¥ä½œï¼ˆTODOï¼‰

### å·²å®Œæˆ âœ…

* [x] ç»Ÿä¸€é…ç½®ç®¡ç†ï¼ˆ.env + config.pyï¼‰
* [x] åŸºç¡€å·¥å…·æ¨¡å—ï¼ˆMySQLã€Milvusã€S3æœ¬åœ°å­˜å‚¨ï¼‰
* [x] å‘é‡ç»´åº¦ç»Ÿä¸€ç®¡ç†ï¼ˆ1536ç»´ï¼‰
* [x] å®éªŒç®¡ç†ç³»ç»Ÿ
* [x] å¿«é€Ÿå¼€å§‹ç¤ºä¾‹
* [x] æ—¥å¿—ç³»ç»Ÿ
* [x] çµæ´»æœç´¢å¼•æ“

### æ­£åœ¨è¿›è¡Œ ğŸ”„

* [ ] æ–‡æ¡£è§£ææ¨¡å—ï¼ˆ`file_process/`ï¼‰
* [ ] çŸ¥è¯†å¤„ç†æ¨¡å—ï¼ˆ`knowledge_process/`ï¼‰
* [ ] æ£€ç´¢ç®¡çº¿ä¼˜åŒ–ï¼ˆ`knowledge_retrieval/`ï¼‰

### è®¡åˆ’ä¸­ ğŸ“‹

* [ ] çœŸå®åµŒå…¥æ¨¡å‹é›†æˆï¼ˆæ›¿æ¢éšæœºå‘é‡ï¼‰
* [ ] Cross-Encoder rerank ç²¾åº¦å®éªŒ
* [ ] Token é¢„ç®—å‹ç¼©ç­–ç•¥ A/B æµ‹è¯•
* [ ] Graph-RAG æ”¯æŒï¼ˆchunk\_relationsï¼‰
* [ ] Webç•Œé¢å’ŒAPIæ¥å£
* [ ] æ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†

### æŠ€æœ¯å€ºåŠ¡ âš ï¸

* [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡æå‡
* [ ] é”™è¯¯å¤„ç†å’Œå¼‚å¸¸ç®¡ç†
* [ ] ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®
* [ ] æ•°æ®åº“è¿ç§»å·¥å…·ï¼ˆAlembicï¼‰
* [ ] å®¹å™¨åŒ–éƒ¨ç½²ä¼˜åŒ–

---

## ğŸ“ æ–‡æ¡£æ›´æ–°è®°å½•

### v0.2 (2025-07-18)
- ğŸ”„ **ä¸å®é™…ä»£ç åŒæ­¥**ï¼šæ›´æ–°æ‰€æœ‰æ¨¡å—çŠ¶æ€ä¸ºå½“å‰çœŸå®æƒ…å†µ
- âœ… **å·²å®ç°åŠŸèƒ½æ ‡è®°**ï¼šæ˜ç¡®æ ‡è¯†å·²å®Œæˆå’Œå¾…å®ç°çš„åŠŸèƒ½
- ğŸ“Š **é…ç½®æ–‡ä»¶æ›´æ–°**ï¼šåæ˜ å½“å‰å®Œæ•´çš„.envé…ç½®
- ğŸ”§ **å·¥ä½œæµæ›´æ–°**ï¼šæ›´æ–°ä¸ºå½“å‰å®é™…å¯ç”¨çš„å‘½ä»¤å’Œæµç¨‹
- ğŸ“ **å‘é‡ç»´åº¦ç»Ÿä¸€**ï¼šæ–‡æ¡£å…¨é¢æ›´æ–°ä¸º1536ç»´é…ç½®
- ğŸ¯ **é¡¹ç›®çŠ¶æ€æ˜ç¡®**ï¼šå¢åŠ å½“å‰é¡¹ç›®çŠ¶æ€è¯´æ˜

### v0.1 (2025-07-18)
- ğŸ“‹ **åˆå§‹æ¶æ„è®¾è®¡**ï¼šå®šä¹‰ç³»ç»Ÿæ€»ä½“æ¶æ„å’Œæ•°æ®æ¨¡å‹
- ğŸ“ **ç›®å½•ç»“æ„è§„åˆ’**ï¼šåˆ¶å®šä»£ç ç»„ç»‡ç»“æ„
- ğŸ”— **æ¥å£å®šä¹‰**ï¼šæ˜ç¡®å„æ¨¡å—é—´çš„æ¥å£è§„èŒƒ

---

> ğŸ’¡ **æç¤º**ï¼šæœ¬æ–‡æ¡£å°†ä¸é¡¹ç›®å¼€å‘ä¿æŒåŒæ­¥æ›´æ–°ï¼Œç¡®ä¿å‡†ç¡®åæ˜ ç³»ç»Ÿå½“å‰çŠ¶æ€ã€‚å¦‚å‘ç°æ–‡æ¡£ä¸å®é™…ä»£ç ä¸ç¬¦ï¼Œè¯·åŠæ—¶åé¦ˆã€‚

